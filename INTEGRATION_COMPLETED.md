# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–¥—É–ª—è –º–µ—Ç—Ä–∏–∫ –≤ rely-lead-processor - –ó–ê–í–ï–†–®–ï–ù–ê

## ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª—è
‚úÖ –ú–æ–¥—É–ª—å —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ `/Users/rgareev91/Downloads/prices/src/metrics/`

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `csv-parse`, `node-cron`, `@types/node-cron`
‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ: `axios`, `puppeteer` (—É–∂–µ –±—ã–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)

### 3. –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è Fastify
‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω `routes.ts` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Fastify –≤–º–µ—Å—Ç–æ Express
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω `index.ts` –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ Fastify –ø–ª–∞–≥–∏–Ω–∞
‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ TypeScript

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è –≤ `src/routes/index.ts`
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –∑–∞–ø—É—Å–∫ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –≤ `src/server.ts`
‚úÖ –ú–æ–¥—É–ª—å –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º

### 5. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚úÖ –°–æ–∑–¥–∞–Ω `src/metrics/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è
‚úÖ –°–æ–∑–¥–∞–Ω `src/metrics/ENV_SETUP.md` - –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª—è

```
src/metrics/
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ abc-metrics-client.ts      ‚úÖ HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è API
‚îÇ   ‚îú‚îÄ‚îÄ svc-workiz-jobs.ts          ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Jobs
‚îÇ   ‚îú‚îÄ‚îÄ svc-workiz-leads.ts         ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Leads
‚îÇ   ‚îú‚îÄ‚îÄ svc-workiz-payments.ts      ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Payments
‚îÇ   ‚îú‚îÄ‚îÄ svc-elocal-calls.ts         ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è Calls
‚îÇ   ‚îî‚îÄ‚îÄ csv.service.ts              ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ CSV
‚îú‚îÄ‚îÄ routes.ts                       ‚úÖ Fastify routes
‚îú‚îÄ‚îÄ scheduler.ts                    ‚úÖ –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ index.ts                        ‚úÖ Entry point
‚îú‚îÄ‚îÄ README.md                       ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ ENV_SETUP.md                   ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
```

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### `src/routes/index.ts`
```typescript
import metricsModule from '../metrics/index.js';

export async function registerRoutes(fastify: FastifyInstance) {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ routes ...
  
  // Metrics module routes
  await fastify.register(metricsModule.registerRoutes);
  
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ routes ...
}
```

### `src/server.ts`
```typescript
// Start metrics scheduler
const metricsModule = await import('./metrics/index.js');
metricsModule.default.scheduler.start();
logger.info('Metrics scheduler started');
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∏

- [x] TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è: **–£—Å–ø–µ—à–Ω–æ** (0 –æ—à–∏–±–æ–∫)
- [x] –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤: **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞**
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: **–í—ã–ø–æ–ª–Ω–µ–Ω–∞**
- [x] –ò–∑–æ–ª—è—Ü–∏—è –º–æ–¥—É–ª—è: **–°–æ–±–ª—é–¥–µ–Ω–∞**
- [x] –ü—Ä–µ—Ñ–∏–∫—Å—ã API: **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ** (`/api/metrics/*`)

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–í Fly.io:**
```bash
flyctl secrets set ABC_METRICS_API_URL="https://abc-metrics.fly.dev" -a rely-lead-processor
flyctl secrets set ABC_METRICS_API_KEY="your-api-key" -a rely-lead-processor
```

**–õ–æ–∫–∞–ª—å–Ω–æ (`.env`):**
```env
ABC_METRICS_API_URL=https://abc-metrics.fly.dev
ABC_METRICS_API_KEY=your-api-key
ELOCAL_USERNAME=help@bostonmasters.com
ELOCAL_PASSWORD=your-password
```

### 2. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á –¥–ª—è abc-metrics

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–ª—é—á–∞
flyctl secrets list -a abc-metrics | grep DB_API_KEY

# –ò–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π
flyctl secrets set DB_API_KEY="your-secure-api-key" -a abc-metrics
```

### 3. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
npm run dev

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å endpoints
curl http://localhost:3000/api/metrics/test/workiz/jobs?start_date=2025-01-01

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
# –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è:
# [METRICS] Starting metrics scheduler...
# [METRICS] Metrics scheduler started successfully
```

### 4. –î–µ–ø–ª–æ–π

```bash
npm run build
npm run fly:deploy
```

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–ú–æ–¥—É–ª—å –º–µ—Ç—Ä–∏–∫ —É—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `rely-lead-processor`:
- ‚úÖ –í—Å–µ —Ñ–∞–π–ª—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- ‚úÖ TypeScript –∫–æ–º–ø–∏–ª—è—Ü–∏—è —É—Å–ø–µ—à–Ω–∞
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- ‚úÖ –ì–æ—Ç–æ–≤ –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **src/metrics/README.md** - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–¥—É–ª—è
- **src/metrics/ENV_SETUP.md** - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **INTEGRATION_INSTRUCTIONS.md** - –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **INTEGRATION_EXAMPLES.md** - –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

## ‚ö†Ô∏è –í–∞–∂–Ω–æ

1. **API –∫–ª—é—á:** `ABC_METRICS_API_KEY` –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å `DB_API_KEY` –≤ `abc-metrics`
2. **–ò–∑–æ–ª—è—Ü–∏—è:** –ú–æ–¥—É–ª—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –≤ `src/metrics/`
3. **–ü—Ä–µ—Ñ–∏–∫—Å—ã:** –í—Å–µ endpoints –∏—Å–ø–æ–ª—å–∑—É—é—Ç `/api/metrics/*`
4. **–ë–î:** –ù–µ—Ç –ø—Ä—è–º—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ –ë–î - –≤—Å–µ —á–µ—Ä–µ–∑ API

---

**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2025-12-14  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ



