# Workiz API - Справочник доступных данных

Согласно [официальной документации Workiz API](https://developer.workiz.com/), через API можно получить доступ к следующим данным:

## Основные ресурсы API

### 1. **Заявки (Jobs)** ✅ Реализовано
- Информация о текущих и завершённых заявках
- Детали заявок (тип, статус, дата)
- Назначенные техники
- Связанные клиенты и адреса
- **Endpoint:** `GET /api/v1/{API_KEY}/jobs`

**Используется в проекте для:**
- Подсчёта Units (Type IN ('COD Service', 'INS Service'))
- Подсчёта Repairs (Type IN ('COD Repair', 'INS Repair') OR (Type = 'COD Service' AND payments > 100))
- Определения сегментов (COD, INS, OTHER)
- Связи с платежами и лидами

### 2. **Лиды (Leads)** ✅ Реализовано
- Данные о потенциальных клиентах
- Источник лида (Source: Pro Referral, Google, Website, eLocals, и т.д.)
- Статус лида (New, Won, Lost, Passed, Closed)
- Связанные заявки (job_id)
- Контактная информация (телефон, имя)
- **Endpoint:** `GET /api/v1/{API_KEY}/leads`

**Используется в проекте для:**
- Подсчёта Leads по источникам
- Расчёта Cost Per Lead (CPL)
- Conversion Rate (Leads → Repairs)
- Pro Referral leads: `source = 'Pro Referral' AND status != 'Passed'`

### 3. **Платежи (Payments)** ✅ Реализовано
- Детали о платежах
- Суммы платежей
- Даты платежей
- Статусы платежей
- Связь с заявками (job_id)
- **Endpoint:** `GET /api/v1/{API_KEY}/payments`

**Используется в проекте для:**
- Расчёта Revenue (gross и revenue40 = sum * 0.40)
- Определения Repairs (COD Service с payments > 100)
- Связи с Jobs для агрегации

### 4. **Звонки (Calls)** ✅ Реализовано (опционально)
- Логи звонков
- Номера телефонов (from/to)
- Длительность звонков
- Связанные заявки
- Источники рекламы (ad_source, ad_group)
- **Endpoint:** `GET /api/v1/{API_KEY}/calls`

**Используется в проекте для:**
- Построения воронки по звонкам
- Аналитики источников трафика
- Связи звонков с лидами и заявками

### 5. **Клиенты (Clients)** ⚠️ Не реализовано
- Информация о клиентах
- Контактные данные
- История взаимодействий
- Адреса обслуживания
- **Endpoint:** `GET /api/v1/{API_KEY}/clients`

**Потенциальное использование:**
- Обогащение данных о клиентах
- Анализ повторных обращений
- Сегментация клиентской базы

### 6. **Счета (Invoices)** ⚠️ Не реализовано
- Информация о выставленных счетах
- Статусы счетов
- Связанные заявки
- Суммы и даты
- **Endpoint:** `GET /api/v1/{API_KEY}/invoices`

**Потенциальное использование:**
- Сопоставление с Payments
- Анализ дебиторской задолженности
- Контроль оплат

### 7. **Расписания (Schedules)** ⚠️ Не реализовано
- Данные о расписании работ
- Назначения техников
- Временные слоты
- **Endpoint:** `GET /api/v1/{API_KEY}/schedules`

**Потенциальное использование:**
- Оптимизация расписания
- Анализ загрузки техников
- Планирование ресурсов

### 8. **Пользователи (Users)** ⚠️ Не реализовано
- Информация о сотрудниках
- Роли и разрешения
- Производительность
- **Endpoint:** `GET /api/v1/{API_KEY}/users`

**Потенциальное использование:**
- Анализ производительности техников
- Управление доступом
- Отчёты по сотрудникам

### 9. **Отчёты (Reports)** ⚠️ Не реализовано
- Различные отчёты и аналитика
- Предустановленные метрики
- **Endpoint:** `GET /api/v1/{API_KEY}/reports`

**Потенциальное использование:**
- Готовая аналитика из Workiz
- Сравнение с собственными метриками
- Валидация данных

## Текущая реализация в проекте

### Реализованные endpoints:

1. **Jobs Sync** - каждый час в :00
   - Синхронизация заявок за последние 30 дней
   - Маппинг полей: job_id, type, source, segment, date, status

2. **Leads Sync** - каждый час в :05
   - Синхронизация лидов за последние 30 дней
   - Маппинг полей: lead_id, source, status, created_at, job_id, client_phone, client_name

3. **Payments Sync** - каждый час в :10
   - Синхронизация платежей за последние 30 дней
   - Маппинг полей: payment_id, job_id, amount, date

4. **Calls Sync** - каждые 6 часов (опционально)
   - Синхронизация звонков за последние 30 дней
   - Маппинг полей: call_id, date, duration, source

## Рекомендации по расширению

### Приоритет 1: Clients API
Может быть полезно для:
- Обогащения данных о клиентах в метриках
- Анализа повторных обращений
- Сегментации клиентской базы

### Приоритет 2: Invoices API
Может быть полезно для:
- Сопоставления счетов с платежами
- Анализа дебиторской задолженности
- Контроля оплат

### Приоритет 3: Reports API
Может быть полезно для:
- Валидации собственных метрик
- Сравнения с данными Workiz
- Дополнительной аналитики

## Формат запросов

Все запросы используют формат:
```
GET https://api.workiz.com/api/v1/{API_KEY}/{resource}?params
```

### Параметры запросов (общие):
- `start_date` - начальная дата (YYYY-MM-DD)
- `end_date` - конечная дата (YYYY-MM-DD)
- `updated_at` - для инкрементальной синхронизации
- `limit` - лимит результатов
- `offset` - смещение для пагинации

## Ограничения API

⚠️ **Важно:** Уточните в документации Workiz API:
- Лимиты запросов (rate limits)
- Максимальный период для запросов
- Доступность endpoints в зависимости от плана
- Формат ответов и структуру данных

## Дополнительные ресурсы

- [Официальная документация Workiz API](https://developer.workiz.com/)
- [Workiz Setup Guide](./WORKIZ_SETUP.md) - настройка API в проекте
- [Architecture Update](./ARCHITECTURE_UPDATE.md) - архитектура проекта

