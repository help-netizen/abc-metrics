# Веб-форма для импорта работ из CSV

Создана веб-форма для удобного импорта исторических данных о работах из CSV файлов.

## Доступ к форме

После запуска приложения откройте в браузере:
```
http://localhost:3000/import-jobs.html
```

Или на продакшене:
```
https://abc-metrics.fly.dev/import-jobs.html
```

Также доступна ссылка с главной страницы: `http://localhost:3000/`

## Возможности

1. **Drag & Drop загрузка** - можно перетащить CSV файл прямо в браузер
2. **Выбор файла** - классический выбор файла через кнопку
3. **Прогресс импорта** - отображение прогресса в реальном времени
4. **Детальная статистика** - показывает количество импортированных записей, пропущенных и ошибок
5. **Обработка ошибок** - показывает список ошибок (если есть)

## Использование

1. Откройте форму импорта
2. Выберите или перетащите CSV файл с данными о работах из Workiz
3. Нажмите "Начать импорт"
4. Дождитесь завершения импорта
5. Просмотрите статистику импорта

## Формат CSV файла

CSV файл должен содержать следующие колонки (как в экспорте Workiz):
- `UUID` - обязательное поле, используется как PRIMARY KEY
- `Job #` - номер работы
- `Job Type` - тип работы
- `Job Date` - дата работы
- `Source` - источник
- `Tech` - техник
- И другие поля из экспорта Workiz

## API Endpoint

Форма использует API endpoint:
```
POST /api/import/jobs-csv
Content-Type: multipart/form-data
Body: csv file
```

Endpoint возвращает streaming ответ с прогрессом в формате:
```json
{"progress": 50, "message": "Импортировано 500 из 1000 записей..."}
{"result": {"success": true, "total": 1000, "imported": 950, "skipped": 50}}
```

## Технические детали

- Использует `multer` для обработки файлов
- Максимальный размер файла: 50MB
- Импорт выполняется в транзакции (атомарно)
- Использует `ON CONFLICT DO UPDATE` для идемпотентности
- Автоматически создает источники в `dim_source` если их нет

## Безопасность

- Проверка типа файла (только CSV)
- Ограничение размера файла
- Валидация данных перед импортом
- Обработка ошибок без прерывания процесса

